{"version":3,"file":"cshtml.js","sources":["../../../src/prism/languages/cshtml.js"],"sourcesContent":["import { languages } from '../core.js';\r\nimport { clone, insertBefore } from '../utils/language.js';\r\nimport { nested, replace } from '../utils/shared.js';\r\nimport './markup.js';\r\nimport './csharp.js';\r\n\r\nvar commentLike = /\\/(?![/*])|\\/\\/.*\\n|\\/\\*[^*]*(?:\\*(?!\\/)[^*]*)*\\*\\//.source;\r\nvar stringLike = `@(?!\")|\"(?:[^\\\\\\\\\\n\"]|\\\\\\\\.)*\"|@\"(?:\\\\\\\\[\\\\s\\\\S]|[^\\\\\\\\\"]|\"\")*\"(?!\")|'(?:(?:[^\\\\\\\\\\n']|\\\\\\\\.|\\\\\\\\[Uux][\\a-fA-F\\d]{1,8})'|(?=[^\\\\\\\\](?!')))`;\r\n\r\nvar round = nested(replace(/\\((?:[^()\"'@/]|<0>|<1>|<self>)*\\)/.source, [stringLike, commentLike]), 2);\r\nvar square = nested(replace(/\\[(?:[^[\\]\"'@/]|<0>|<1>|<self>)*\\]/.source, [stringLike, commentLike]), 1);\r\nvar curly = nested(replace(/\\{(?:[^{}\"'@/]|<0>|<1>|<self>)*\\}/.source, [stringLike, commentLike]), 2);\r\nvar angle = nested(replace(/<(?:[^<>\"'@/]|<0>|<self>)*>/.source, [commentLike]), 1);\r\n\r\nvar inlineCs = `@(?:await\\\\b\\\\s*)?(?:(?!await\\\\b)\\\\w+\\\\b|${round})(?:[?!]?\\\\.\\\\w+\\\\b|(?:${angle})?${round}|${square})*(?![?!\\\\.(\\\\[]|<(?!\\\\/))`;\r\n\r\n// Note about the above bracket patterns:\r\n// They all ignore HTML expressions that might be in the C# code. This is a problem because HTML (like strings and\r\n// comments) is parsed differently. This is a huge problem because HTML might contain brackets and quotes which\r\n// messes up the bracket and string counting implemented by the above patterns.\r\n//\r\n// This problem is not fixable because 1) HTML expression are highly context sensitive and very difficult to detect\r\n// and 2) they require one capturing group at every nested level. See the `tagRegion` pattern to admire the\r\n// complexity of an HTML expression.\r\n//\r\n// To somewhat alleviate the problem a bit, the patterns for characters (e.g. 'a') is very permissive, it also\r\n// allows invalid characters to support HTML expressions like this: <p>That's it!</p>.\r\n\r\nvar tagAttrInlineCs = \"@(?![()\\\\w])|\" + inlineCs;\r\nvar tagAttrValue = `(?:\"[^\"@]*\"|'[^'@]*'|[^\\\\s\"'@=>]+(?=[\\\\s>])|[\"'][^\"'@]*(?:(?:${tagAttrInlineCs})[^\"\\'@]*)+[\"\\'])`;\r\n\r\nvar tagAttrs = `(?:\\\\s(?:\\\\s*[^\\\\s/=>]+(?:\\\\s*=\\\\s*${tagAttrValue}|(?=[\\\\s/>])))+)?`;\r\nvar tagContent = `(?!\\\\d)[^\\\\s/=>$<%]+${tagAttrs}\\\\s*\\\\/?>`;\r\nvar tagRegion = `\\\\B@?(?:<([a-zA-Z][\\\\w:]*)${tagAttrs}\\\\s*>(?:[^<]|<\\\\/?(?!\\\\1\\\\b)${tagContent}|${nested(\r\n\t`<\\\\1${tagAttrs}\\\\s*>(?:[^<]|<\\\\/?(?!\\\\1\\\\b)${tagContent}|<self>)*<\\\\/\\\\1\\\\s*>`, 2\r\n)})*<\\\\/\\\\1\\\\s*>|<${tagContent})`\r\n\r\n// Now for the actual language definition(s):\r\n//\r\n// Razor as a language has 2 parts:\r\n//  1) CSHTML: A markup-like language that has been extended with inline C# code expressions and blocks.\r\n//  2) C#+HTML: A variant of C# that can contain CSHTML tags as expressions.\r\n//\r\n// In the below code, both CSHTML and C#+HTML will be create as separate language definitions that reference each\r\n// other. However, only CSHTML will be exported via `languages`.\r\n\r\nvar cshtml = languages.razor = languages.cshtml = clone(languages.html);\r\n\r\nvar csharpWithHtml = clone(languages.cs);\r\n\r\nvar cs = {\r\n\tpattern: /\\S[\\s\\S]*/,\r\n\talias: 'language-csharp',\r\n\tinside: csharpWithHtml\r\n};\r\n\r\nvar inlineValue = {\r\n\tpattern: RegExp(/(^|[^@])/.source + inlineCs, 'g'),\r\n\tlookbehind: true,\r\n\tgreedy: true,\r\n\talias: 'variable',\r\n\tinside: {\r\n\t\t'keyword': /^@/,\r\n\t\t'csharp': cs\r\n\t}\r\n};\r\n\r\nvar attrValue = cshtml.tag.inside['attr-value'][2];\r\n\r\ncshtml.tag.pattern = RegExp(/<\\/?/.source + tagContent, 'g');\r\nattrValue.pattern = RegExp(/(=\\s*)/.source + tagAttrValue, 'g');\r\n\r\ninsertBefore(csharpWithHtml, 'string', {\r\n\t'html': {\r\n\t\tpattern: RegExp(tagRegion, 'g'),\r\n\t\tgreedy: true,\r\n\t\tinside: cshtml\r\n\t}\r\n});\r\n\r\ninsertBefore(attrValue.inside, 'punctuation', { 'value': inlineValue });\r\n\r\ninsertBefore(cshtml, 'prolog', {\r\n\t'razor-comment': {\r\n\t\tpattern: /@\\*[\\s\\S]*?\\*@/g,\r\n\t\tgreedy: true,\r\n\t\talias: 'comment'\r\n\t},\r\n\r\n\t'block': {\r\n\t\tpattern: RegExp(\r\n\t\t\t`(^|[^@])@(?:${curly}|(?:code|functions)\\\\s*${curly}|(?:for|foreach|lock|switch|using|while)\\\\s*${\r\n\t\t\t\tround\r\n\t\t\t}\\\\s*${curly}|do\\\\s*${curly}\\\\s*while\\\\s*${round}(?:\\\\s*;)?|try\\\\s*${curly}\\\\s*catch\\\\s*${round}\\\\s*${curly}\\\\s*finally\\\\s*${\r\n\t\t\t\tcurly\r\n\t\t\t}|if\\\\s*${round}\\\\s*${curly}(?:\\\\s*else(?:\\\\s+if\\\\s*${round})?\\\\s*${curly})*|helper\\\\s+\\\\w+\\\\s*${round}\\\\s*${curly})`, 'g'\r\n\t\t),\r\n\t\tlookbehind: true,\r\n\t\tgreedy: true,\r\n\t\tinside: {\r\n\t\t\t'keyword': /^@\\w*/,\r\n\t\t\t'csharp': cs\r\n\t\t}\r\n\t},\r\n\r\n\t'directive': {\r\n\t\tpattern: /^([ \\t]*)@(?:addTagHelper|attribute|implements|inherits|inject|layout|model|namespace|page|preservewhitespace|removeTagHelper|section|tagHelperPrefix|using)(?=\\s).*/mg,\r\n\t\tlookbehind: true,\r\n\t\tgreedy: true,\r\n\t\tinside: {\r\n\t\t\t'keyword': /^@\\w+/,\r\n\t\t\t'csharp': cs\r\n\t\t}\r\n\t},\r\n\r\n\t'value': inlineValue,\r\n\r\n\t'delegate-operator': {\r\n\t\tpattern: /(^|[^@])@(?=<)/,\r\n\t\tlookbehind: true,\r\n\t\talias: 'operator'\r\n\t}\r\n});\r\n"],"names":[],"mappings":";;;;;AAMA,IAAI,cAAc;AAClB,IAAI,aAAa;AAAA;AAAA;AAEjB,IAAI,QAAQ,OAAO,QAAQ,uCAA4C,CAAC,YAAY,WAAW,CAAC,GAAG,CAAC;AACpG,IAAI,SAAS,OAAO,QAAQ,yCAA6C,CAAC,YAAY,WAAW,CAAC,GAAG,CAAC;AACtG,IAAI,QAAQ,OAAO,QAAQ,uCAA4C,CAAC,YAAY,WAAW,CAAC,GAAG,CAAC;AACpG,IAAI,QAAQ,OAAO,QAAQ,+BAAsC,CAAC,WAAW,CAAC,GAAG,CAAC;AAElF,IAAI,WAAW,4CAA4C,KAAK,0BAA0B,KAAK,KAAK,KAAK,IAAI,MAAM;AAcnH,IAAI,kBAAkB,kBAAkB;AACxC,IAAI,eAAe,gEAAgE,eAAe;AAElG,IAAI,WAAW,sCAAsC,YAAY;AACjE,IAAI,aAAa,uBAAuB,QAAQ;AAChD,IAAI,YAAY,6BAA6B,QAAQ,+BAA+B,UAAU,IAAI;AAAA,EACjG,OAAO,QAAQ,+BAA+B,UAAU;AAAA,EAAyB;AAClF,CAAC,mBAAmB,UAAU;AAW9B,IAAI,SAAS,UAAU,QAAQ,UAAU,SAAS,MAAM,UAAU,IAAI;AAEtE,IAAI,iBAAiB,MAAM,UAAU,EAAE;AAEvC,IAAI,KAAK;AAAA,EACR,SAAS;AAAA,EACT,OAAO;AAAA,EACP,QAAQ;AACT;AAEA,IAAI,cAAc;AAAA,EACjB,SAAS,OAAO,aAAoB,UAAU,GAAG;AAAA,EACjD,YAAY;AAAA,EACZ,QAAQ;AAAA,EACR,OAAO;AAAA,EACP,QAAQ;AAAA,IACP,WAAW;AAAA,IACX,UAAU;AAAA,EACV;AACF;AAEA,IAAI,YAAY,OAAO,IAAI,OAAO,YAAY,EAAE,CAAC;AAEjD,OAAO,IAAI,UAAU,OAAO,QAAgB,YAAY,GAAG;AAC3D,UAAU,UAAU,OAAO,YAAkB,cAAc,GAAG;AAE9D,aAAa,gBAAgB,UAAU;AAAA,EACtC,QAAQ;AAAA,IACP,SAAS,OAAO,WAAW,GAAG;AAAA,IAC9B,QAAQ;AAAA,IACR,QAAQ;AAAA,EACR;AACF,CAAC;AAED,aAAa,UAAU,QAAQ,eAAe,EAAE,SAAS,YAAW,CAAE;AAEtE,aAAa,QAAQ,UAAU;AAAA,EAC9B,iBAAiB;AAAA,IAChB,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,OAAO;AAAA,EACP;AAAA,EAED,SAAS;AAAA,IACR,SAAS;AAAA,MACR,eAAe,KAAK,0BAA0B,KAAK,+CAClD,KACA,OAAM,KAAK,UAAU,KAAK,gBAAgB,KAAK,qBAAqB,KAAK,gBAAgB,KAAK,OAAO,KAAK,kBAC1G,KACA,UAAS,KAAK,OAAO,KAAK,2BAA2B,KAAK,SAAS,KAAK,wBAAwB,KAAK,OAAO,KAAK;AAAA,MAAK;AAAA,IACvH;AAAA,IACD,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,QAAQ;AAAA,MACP,WAAW;AAAA,MACX,UAAU;AAAA,IACV;AAAA,EACD;AAAA,EAED,aAAa;AAAA,IACZ,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,QAAQ;AAAA,MACP,WAAW;AAAA,MACX,UAAU;AAAA,IACV;AAAA,EACD;AAAA,EAED,SAAS;AAAA,EAET,qBAAqB;AAAA,IACpB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,OAAO;AAAA,EACP;AACF,CAAC;"}