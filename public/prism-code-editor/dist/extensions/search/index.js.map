{"version":3,"file":"index.js","sources":["../../../src/extensions/search/invisibles.ts"],"sourcesContent":["import { BasicExtension } from \"../../index.js\"\r\nimport { createSearchAPI } from \"./search.js\"\r\n\r\n/**\r\n * Extension that shows tabs and spaces.\r\n * @param alwaysShow By default, spaces and tabs are only shown when they're selected.\r\n * By passing `true`, they're always shown, which negatively impacts performance when\r\n * typing, and increases the amount of elements in the DOM.\r\n *\r\n * Requires styling from `prism-code-editor/invisibles.css`.\r\n */\r\nconst showInvisibles = (alwaysShow?: boolean): BasicExtension => {\r\n\treturn editor => {\r\n\t\tlet prev: string\r\n\t\tconst searchAPI = createSearchAPI(editor)\r\n\t\tconst matches = searchAPI.matches\r\n\t\tconst container = searchAPI.container\r\n\t\tconst nodes = container.children\r\n\t\tconst tabs: boolean[] = []\r\n\t\tconst update = () => {\r\n\t\t\tconst value = editor.value\r\n\t\t\tconst [start, end] = editor.getSelection()\r\n\r\n\t\t\tif (!alwaysShow || prev != (prev = value)) {\r\n\t\t\t\tsearchAPI.search(\" |\\t\", true, false, true, alwaysShow ? undefined : [start, end])\r\n\t\t\t\tfor (let i = 0, l = matches.length; i < l; i++) {\r\n\t\t\t\t\tif ((value[matches[i][0]] == \"\\t\") == !tabs[i]) {\r\n\t\t\t\t\t\tnodes[i].className = (tabs[i] = !tabs[i]) ? \"pce-tab\" : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcontainer.className = \"pce-invisibles\"\r\n\t\tif (editor.value) update()\r\n\t\teditor.addListener(\"selectionChange\", update)\r\n\t}\r\n}\r\n\r\nexport { showInvisibles }\r\n"],"names":[],"mappings":";;;AAWM,MAAA,iBAAiB,CAAC,eAAyC;AAChE,SAAO,CAAU,WAAA;AACZ,QAAA;AACE,UAAA,YAAY,gBAAgB,MAAM;AACxC,UAAM,UAAU,UAAU;AAC1B,UAAM,YAAY,UAAU;AAC5B,UAAM,QAAQ,UAAU;AACxB,UAAM,OAAkB,CAAA;AACxB,UAAM,SAAS,MAAM;AACpB,YAAM,QAAQ,OAAO;AACrB,YAAM,CAAC,OAAO,GAAG,IAAI,OAAO,aAAa;AAEzC,UAAI,CAAC,cAAc,SAAS,OAAO,QAAQ;AAChC,kBAAA,OAAO,OAAQ,MAAM,OAAO,MAAM,aAAa,SAAY,CAAC,OAAO,GAAG,CAAC;AACjF,iBAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,IAAI,GAAG,KAAK;AAC1C,cAAA,MAAM,QAAQ,CAAC,EAAE,CAAC,CAAC,KAAK,OAAS,CAAC,KAAK,CAAC,GAAG;AACzC,kBAAA,CAAC,EAAE,aAAa,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,YAAY;AAAA,UACzD;AAAA,QACD;AAAA,MACD;AAAA,IAAA;AAGD,cAAU,YAAY;AACtB,QAAI,OAAO;AAAc;AAClB,WAAA,YAAY,mBAAmB,MAAM;AAAA,EAAA;AAE9C;"}