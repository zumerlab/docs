{"version":3,"file":"tooltips.js","sources":["../src/tooltips.ts"],"sourcesContent":["import { PrismEditor } from \"./index.js\"\r\nimport { createTemplate } from \"./core.js\"\r\nimport { cursorPosition } from \"./extensions/cursor.js\"\r\nimport { getStyleValue } from \"./utils/local.js\"\r\n\r\nconst template = /* @__PURE__ */ createTemplate(\r\n\t\"<div class=pce-tooltip style=z-index:5;top:auto;display:flex;overflow-x:clip><div>\",\r\n)\r\n\r\n/**\r\n * Moves to tooltip to align with the cursor and shows it.\r\n * @param preferPlacingAboveCursor Whether the preferred position is above the cursor or not.\r\n */\r\nexport type ShowTooltip = (preferPlacingAboveCursor?: boolean) => void\r\n\r\n/** Function removing the tooltip from the DOM. */\r\nexport type HideTooltip = () => void\r\n\r\n/**\r\n * Utility making it easy to add tooltips positioned on the cursor to an editor. Before you\r\n * can show the tooltip, a {@link cursorPosition} extension must be added to the editor.\r\n *\r\n * This works by appending your tooltip to a flex container. You can style this container\r\n * with the selector `.pce-tooltip` if needed. This container is then added to the editor's\r\n * overlays. It also has `overflow-x: clip` to prevent your tooltip from overflowing in\r\n * browsers that support it.\r\n *\r\n * If you want your tooltip to always be visible when scrolling horizontally, you can add\r\n * `position: sticky` along with the `right` and `left` CSS properties to it.\r\n *\r\n * @param editor Editor you want to add the tooltip to.\r\n * @param element Element for the tooltip.\r\n * @param fixedWidth If false, the tooltip will shrink instead of getting offset to\r\n * the left if there's not enough space to the right of the cursor. Defaults to `true`.\r\n * @returns Show and hide functions.\r\n *\r\n * @example\r\n * const [show, hide] = addTooltip(editor, element)\r\n */\r\nexport const addTooltip = (\r\n\teditor: PrismEditor,\r\n\telement: HTMLElement,\r\n\tfixedWidth = true,\r\n): [ShowTooltip, HideTooltip] => {\r\n\tconst container = template()\r\n\tconst style = container.style\r\n\tconst spacer = <HTMLDivElement>container.firstChild\r\n\r\n\tcontainer.append(element)\r\n\t;(fixedWidth ? element : spacer).style.flexShrink = <any>0\r\n\r\n\treturn [\r\n\t\t(above?: boolean) => {\r\n\t\t\tlet cursor = editor.extensions.cursor\r\n\t\t\tif (cursor) {\r\n\t\t\t\tlet { left, right, top, bottom, height } = cursor.getPosition()\r\n\t\t\t\tcontainer.parentNode || editor.overlays.append(container)\r\n\t\t\t\tspacer.style.width = (editor.options.rtl ? right : left) + \"px\"\r\n\r\n\t\t\t\tlet placeAbove =\r\n\t\t\t\t\t!above == top > bottom && (above ? top : bottom) < container.clientHeight ? !above : above\r\n\r\n\t\t\t\tstyle[placeAbove ? \"bottom\" : \"top\"] = height + (placeAbove ? bottom : top) + \"px\"\r\n\t\t\t\tstyle[placeAbove ? \"top\" : \"bottom\"] = \"auto\"\r\n\t\t\t}\r\n\t\t},\r\n\t\t() => container.remove(),\r\n\t]\r\n}\r\n\r\nconst observer =\r\n\twindow.ResizeObserver &&\r\n\t/* @__PURE__ */ new ResizeObserver(e =>\r\n\t\te.forEach(entry => {\r\n\t\t\tconst el = entry.target\r\n\t\t\tconst wrapper = el.querySelector<HTMLDivElement>(\".pce-wrapper\")!\r\n\t\t\twrapper.style.paddingBottom = `${\r\n\t\t\t\tel.clientHeight -\r\n\t\t\t\tgetStyleValue(wrapper, \"marginBottom\") -\r\n\t\t\t\tgetStyleValue(wrapper, \"lineHeight\")\r\n\t\t\t}px`\r\n\t\t}),\r\n\t)\r\n\r\n/** Allows users to scroll past the last line in the editor by adding padding to the wrapper. */\r\nexport const addOverscroll = (editor: PrismEditor) => {\r\n\tobserver && observer.observe(editor.scrollContainer)\r\n}\r\n\r\n/** Removes the ability to scroll past the last line in the editor. */\r\nexport const removeOverscroll = (editor: PrismEditor) => {\r\n\tobserver && observer.unobserve(editor.scrollContainer)\r\n\teditor.wrapper.style.paddingBottom = \"\"\r\n}\r\n"],"names":[],"mappings":";;AAKA,MAAM,WAA2B;AAAA,EAChC;AACD;AAgCO,MAAM,aAAa,CACzB,QACA,SACA,aAAa,SACmB;AAChC,QAAM,YAAY;AAClB,QAAM,QAAQ,UAAU;AACxB,QAAM,SAAyB,UAAU;AAEzC,YAAU,OAAO,OAAO;AACvB,GAAC,aAAa,UAAU,QAAQ,MAAM,aAAkB;AAElD,SAAA;AAAA,IACN,CAAC,UAAoB;AAChB,UAAA,SAAS,OAAO,WAAW;AAC/B,UAAI,QAAQ;AACP,YAAA,EAAE,MAAM,OAAO,KAAK,QAAQ,OAAO,IAAI,OAAO;AAClD,kBAAU,cAAc,OAAO,SAAS,OAAO,SAAS;AACxD,eAAO,MAAM,SAAS,OAAO,QAAQ,MAAM,QAAQ,QAAQ;AAEvD,YAAA,aACH,CAAC,SAAS,MAAM,WAAW,QAAQ,MAAM,UAAU,UAAU,eAAe,CAAC,QAAQ;AAEtF,cAAM,aAAa,WAAW,KAAK,IAAI,UAAU,aAAa,SAAS,OAAO;AACxE,cAAA,aAAa,QAAQ,QAAQ,IAAI;AAAA,MACxC;AAAA,IACD;AAAA,IACA,MAAM,UAAU,OAAO;AAAA,EAAA;AAEzB;AAEA,MAAM,WACL,OAAO,kBACa,oBAAA;AAAA,EAAe,CAAA,MAClC,EAAE,QAAQ,CAAS,UAAA;AAClB,UAAM,KAAK,MAAM;AACX,UAAA,UAAU,GAAG,cAA8B,cAAc;AAC/D,YAAQ,MAAM,gBAAgB,GAC7B,GAAG,eACH,cAAc,SAAS,cAAc,IACrC,cAAc,SAAS,YAAY,CACpC;AAAA,EAAA,CACA;AACF;AAGY,MAAA,gBAAgB,CAAC,WAAwB;AACzC,cAAA,SAAS,QAAQ,OAAO,eAAe;AACpD;AAGa,MAAA,mBAAmB,CAAC,WAAwB;AAC5C,cAAA,SAAS,UAAU,OAAO,eAAe;AAC9C,SAAA,QAAQ,MAAM,gBAAgB;AACtC;"}