{"version":3,"file":"index-CHhGi2gg.js","sources":["../src/languages/shared/index.ts"],"sourcesContent":["import { CommentTokens, InputSelection, Language, PrismEditor, languageMap } from \"../..\"\r\nimport { getClosestToken, getLineBefore } from \"../../utils\"\r\n\r\nconst clikeIndent = /[([{][^)\\]}]*$|^[^.]*\\b(?:case .+?|default):\\s*$/,\r\n\tisBracketPair = /\\[]|\\(\\)|{}/,\r\n\txmlOpeningTag =\r\n\t\t/<(?![?!\\d#@])([^\\s/=>$<%]+)(?:\\s(?:\\s*[^\\s/\"'=>]+(?:\\s*=\\s*(?!\\s)(?:\"[^\"]*\"|'[^']*'|[^\\s\"'=>]+(?=[\\s>]))?|(?=[\\s/>])))+)?\\s*>[ \\t]*$/,\r\n\txmlClosingTag = /^<\\/(?!\\d)[^\\s/=>$<%]+\\s*>/,\r\n\topenBracket = /[([{][^)\\]}]*$/\r\n\r\nconst testBracketPair = ([start, end]: InputSelection, value: string) => {\r\n\treturn isBracketPair.test(value[start - 1] + value[end])\r\n}\r\n\r\nconst clikeComment: CommentTokens = {\r\n\tline: \"//\",\r\n\tblock: [\"/*\", \"*/\"],\r\n}\r\n\r\nconst voidTags = /^(?:area|base|w?br|col|embed|hr|img|input|link|meta|source|track)$/i\r\n\r\nconst isOpen = (match: RegExpMatchArray | null, voidTags?: RegExp) =>\r\n\t!!match && !voidTags?.test(match[1])\r\n\r\nconst htmlAutoIndent = (tagPattern: RegExp, voidTags?: RegExp): Language[\"autoIndent\"] => [\r\n\t([start], value) =>\r\n\t\tisOpen(value.slice(0, start).match(tagPattern), voidTags) ||\r\n\t\topenBracket.test(getLineBefore(value, start)),\r\n\t(selection, value) =>\r\n\t\ttestBracketPair(selection, value) ||\r\n\t\t(isOpen(value.slice(0, selection[0]).match(tagPattern), voidTags) &&\r\n\t\t\txmlClosingTag.test(value.slice(selection[1]))),\r\n]\r\n\r\nconst markupComment: CommentTokens = {\r\n\tblock: [\"<!--\", \"-->\"],\r\n}\r\n\r\nconst markupLanguage = (\r\n\tcomment = markupComment,\r\n\ttagPattern = xmlOpeningTag,\r\n\tvoidTags?: RegExp,\r\n): Language => ({\r\n\tcomments: comment,\r\n\tautoIndent: htmlAutoIndent(tagPattern, voidTags),\r\n\tautoCloseTags: ([start, end], value, editor) => {\r\n\t\treturn autoCloseTags(editor, start, end, value, tagPattern, voidTags)\r\n\t},\r\n})\r\n\r\nconst autoCloseTags = (\r\n\teditor: PrismEditor,\r\n\tstart: number,\r\n\tend: number,\r\n\tvalue: string,\r\n\ttagPattern: RegExp,\r\n\tvoidTags?: RegExp,\r\n) => {\r\n\tif (start == end) {\r\n\t\tlet match: string | RegExpExecArray | null = tagPattern.exec(value.slice(0, start) + \">\")\r\n\t\tlet tagMatcher = editor.extensions.matchTags\r\n\t\tif (match && ((match = match[1] || \"\"), !voidTags?.test(match))) {\r\n\t\t\tif (tagMatcher) {\r\n\t\t\t\tlet { pairs, tags } = tagMatcher\r\n\t\t\t\tfor (let i = tags.length; i; ) {\r\n\t\t\t\t\tlet tag = tags[--i]\r\n\t\t\t\t\tif (tag[1] >= start && tag[4] && tag[5] && tag[3] == match && pairs[i] == null) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn `</${match}>`\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst bracketIndenting = (comments = clikeComment, indentPattern = openBracket): Language => ({\r\n\tcomments,\r\n\tautoIndent: [\r\n\t\t([start], value) => indentPattern.test(getLineBefore(value, start)),\r\n\t\ttestBracketPair,\r\n\t],\r\n})\r\n\r\nconst markupTemplateLang = (name: string, comments: CommentTokens): Language =>\r\n\t(languageMap[name] = {\r\n\t\tcomments,\r\n\t\tautoIndent: htmlAutoIndent(xmlClosingTag, voidTags),\r\n\t\tautoCloseTags: ([start, end], value, editor) => {\r\n\t\t\treturn getClosestToken(editor, \".\" + name, 0, 0, start)\r\n\t\t\t\t? \"\"\r\n\t\t\t\t: autoCloseTags(editor, start, end, value, xmlOpeningTag, voidTags)\r\n\t\t},\r\n\t})\r\n\r\nexport {\r\n\tclikeIndent,\r\n\tisBracketPair,\r\n\txmlOpeningTag,\r\n\txmlClosingTag,\r\n\topenBracket,\r\n\tautoCloseTags,\r\n\ttestBracketPair,\r\n\tclikeComment,\r\n\tbracketIndenting,\r\n\thtmlAutoIndent,\r\n\tvoidTags,\r\n\tmarkupTemplateLang,\r\n\tmarkupLanguage,\r\n\tmarkupComment,\r\n}\r\n"],"names":["voidTags"],"mappings":";;AAGM,MAAA,cAAc,oDACnB,gBAAgB,eAChB,gBACC,uIACD,gBAAgB,8BAChB,cAAc;AAEf,MAAM,kBAAkB,CAAC,CAAC,OAAO,GAAG,GAAmB,UAAkB;AACjE,SAAA,cAAc,KAAK,MAAM,QAAQ,CAAC,IAAI,MAAM,GAAG,CAAC;AACxD;AAEA,MAAM,eAA8B;AAAA,EACnC,MAAM;AAAA,EACN,OAAO,CAAC,MAAM,IAAI;AACnB;AAEA,MAAM,WAAW;AAEjB,MAAM,SAAS,CAAC,OAAgCA,cAC/C,CAAC,CAAC,SAAS,CAACA,WAAU,KAAK,MAAM,CAAC,CAAC;AAE9B,MAAA,iBAAiB,CAAC,YAAoBA,cAA8C;AAAA,EACzF,CAAC,CAAC,KAAK,GAAG,UACT,OAAO,MAAM,MAAM,GAAG,KAAK,EAAE,MAAM,UAAU,GAAGA,SAAQ,KACxD,YAAY,KAAK,cAAc,OAAO,KAAK,CAAC;AAAA,EAC7C,CAAC,WAAW,UACX,gBAAgB,WAAW,KAAK,KAC/B,OAAO,MAAM,MAAM,GAAG,UAAU,CAAC,CAAC,EAAE,MAAM,UAAU,GAAGA,SAAQ,KAC/D,cAAc,KAAK,MAAM,MAAM,UAAU,CAAC,CAAC,CAAC;AAC/C;AAEA,MAAM,gBAA+B;AAAA,EACpC,OAAO,CAAC,QAAQ,KAAK;AACtB;AAEA,MAAM,iBAAiB,CACtB,UAAU,eACV,aAAa,eACbA,eACe;AAAA,EACf,UAAU;AAAA,EACV,YAAY,eAAe,YAAYA,SAAQ;AAAA,EAC/C,eAAe,CAAC,CAAC,OAAO,GAAG,GAAG,OAAO,WAAW;AAC/C,WAAO,cAAc,QAAQ,OAAO,KAAK,OAAO,YAAYA,SAAQ;AAAA,EACrE;AACD;AAEA,MAAM,gBAAgB,CACrB,QACA,OACA,KACA,OACA,YACAA,cACI;AACJ,MAAI,SAAS,KAAK;AACb,QAAA,QAAyC,WAAW,KAAK,MAAM,MAAM,GAAG,KAAK,IAAI,GAAG;AACpF,QAAA,aAAa,OAAO,WAAW;AAC/B,QAAA,UAAW,QAAQ,MAAM,CAAC,KAAK,IAAK,CAACA,WAAU,KAAK,KAAK,IAAI;AAChE,UAAI,YAAY;AACX,YAAA,EAAE,OAAO,KAAS,IAAA;AACb,iBAAA,IAAI,KAAK,QAAQ,KAAK;AAC1B,cAAA,MAAM,KAAK,EAAE,CAAC;AAClB,cAAI,IAAI,CAAC,KAAK,SAAS,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,SAAS,MAAM,CAAC,KAAK,MAAM;AAC/E;AAAA,UACD;AAAA,QACD;AAAA,MACD;AACA,aAAO,KAAK,KAAK;AAAA,IAClB;AAAA,EACD;AACD;AAEA,MAAM,mBAAmB,CAAC,WAAW,cAAc,gBAAgB,iBAA2B;AAAA,EAC7F;AAAA,EACA,YAAY;AAAA,IACX,CAAC,CAAC,KAAK,GAAG,UAAU,cAAc,KAAK,cAAc,OAAO,KAAK,CAAC;AAAA,IAClE;AAAA,EACD;AACD;AAEA,MAAM,qBAAqB,CAAC,MAAc,aACxC,YAAY,IAAI,IAAI;AAAA,EACpB;AAAA,EACA,YAAY,eAAe,eAAe,QAAQ;AAAA,EAClD,eAAe,CAAC,CAAC,OAAO,GAAG,GAAG,OAAO,WAAW;AAC/C,WAAO,gBAAgB,QAAQ,MAAM,MAAM,GAAG,GAAG,KAAK,IACnD,KACA,cAAc,QAAQ,OAAO,KAAK,OAAO,eAAe,QAAQ;AAAA,EACpE;AACD;"}